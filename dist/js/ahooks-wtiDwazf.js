import{_ as p,a as g,b as R,c as K,d as Q,e as z}from"./tslib-g6pQwBLH.js";import{d as X,t as U}from"./lodash-liWoq_f8.js";var Y=function(e){return function(n,t){var r=React.useRef(!1);e(function(){return function(){r.current=!1}},[]),e(function(){if(!r.current)r.current=!0;else return n()},t)}},G=function(e){return typeof e=="function"};function w(e){var n=React.useRef(e);n.current=React.useMemo(function(){return e},[e]);var t=React.useRef();return t.current||(t.current=function(){for(var r=[],u=0;u<arguments.length;u++)r[u]=arguments[u];return n.current.apply(this,r)}),t.current}const B=Y(React.useEffect);var q=function(e,n){var t=n.manual,r=n.ready,u=r===void 0?!0:r,i=n.defaultParams,o=i===void 0?[]:i,s=n.refreshDeps,c=s===void 0?[]:s,a=n.refreshDepsAction,d=React.useRef(!1);return d.current=!1,B(function(){!t&&u&&(d.current=!0,e.run.apply(e,p([],g(o),!1)))},[u]),B(function(){d.current||t||(d.current=!0,a?a():e.refresh())},p([],g(c),!1)),{onBefore:function(){if(!u)return{stopNow:!0}}}};q.onInit=function(e){var n=e.ready,t=n===void 0?!0:n,r=e.manual;return{loading:!r&&t}};const Z=q;function k(e,n){if(e===n)return!0;for(var t=0;t<e.length;t++)if(!Object.is(e[t],n[t]))return!1;return!0}function J(e,n){var t=React.useRef({deps:n,obj:void 0,initialized:!1}).current;return(t.initialized===!1||!k(t.deps,n))&&(t.deps=n,t.obj=e(),t.initialized=!0),t.obj}function j(e){var n=React.useRef(e);return n.current=e,n}var M=function(e){var n=j(e);React.useEffect(function(){return function(){n.current()}},[])},F=new Map,I=function(e,n,t){var r=F.get(e);r?.timer&&clearTimeout(r.timer);var u=void 0;n>-1&&(u=setTimeout(function(){F.delete(e)},n)),F.set(e,R(R({},t),{timer:u}))},V=function(e){return F.get(e)},O=new Map,ee=function(e){return O.get(e)},ne=function(e,n){O.set(e,n),n.then(function(t){return O.delete(e),t}).catch(function(){O.delete(e)})},P={},te=function(e,n){P[e]&&P[e].forEach(function(t){return t(n)})},$=function(e,n){return P[e]||(P[e]=[]),P[e].push(n),function(){var r=P[e].indexOf(n);P[e].splice(r,1)}},re=function(e,n){var t=n.cacheKey,r=n.cacheTime,u=r===void 0?5*60*1e3:r,i=n.staleTime,o=i===void 0?0:i,s=n.setCache,c=n.getCache,a=React.useRef(),d=React.useRef(),f=function(l,v){s?s(v):I(l,u,v),te(l,v.data)},h=function(l,v){return v===void 0&&(v=[]),c?c(v):V(l)};return J(function(){if(t){var l=h(t);l&&Object.hasOwnProperty.call(l,"data")&&(e.state.data=l.data,e.state.params=l.params,(o===-1||new Date().getTime()-l.time<=o)&&(e.state.loading=!1)),a.current=$(t,function(v){e.setState({data:v})})}},[]),M(function(){var l;(l=a.current)===null||l===void 0||l.call(a)}),t?{onBefore:function(l){var v=h(t,l);return!v||!Object.hasOwnProperty.call(v,"data")?{}:o===-1||new Date().getTime()-v.time<=o?{loading:!1,data:v?.data,error:void 0,returnNow:!0}:{data:v?.data,error:void 0}},onRequest:function(l,v){var m=ee(t);return m&&m!==d.current?{servicePromise:m}:(m=l.apply(void 0,p([],g(v),!1)),d.current=m,ne(t,m),{servicePromise:m})},onSuccess:function(l,v){var m;t&&((m=a.current)===null||m===void 0||m.call(a),f(t,{data:l,params:v,time:new Date().getTime()}),a.current=$(t,function(E){e.setState({data:E})}))},onMutate:function(l){var v;t&&((v=a.current)===null||v===void 0||v.call(a),f(t,{data:l,params:e.state.params,time:new Date().getTime()}),a.current=$(t,function(m){e.setState({data:m})}))}}:{}};const ue=re;var ae=function(e,n){var t=n.debounceWait,r=n.debounceLeading,u=n.debounceTrailing,i=n.debounceMaxWait,o=React.useRef(),s=React.useMemo(function(){var c={};return r!==void 0&&(c.leading=r),u!==void 0&&(c.trailing=u),i!==void 0&&(c.maxWait=i),c},[r,u,i]);return React.useEffect(function(){if(t){var c=e.runAsync.bind(e);return o.current=X(function(a){a()},t,s),e.runAsync=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return new Promise(function(f,h){var l;(l=o.current)===null||l===void 0||l.call(o,function(){c.apply(void 0,p([],g(a),!1)).then(f).catch(h)})})},function(){var a;(a=o.current)===null||a===void 0||a.cancel(),e.runAsync=c}}},[t,s]),t?{onCancel:function(){var c;(c=o.current)===null||c===void 0||c.cancel()}}:{}};const ie=ae;var oe=function(e,n){var t=n.loadingDelay,r=n.ready,u=React.useRef();if(!t)return{};var i=function(){u.current&&clearTimeout(u.current)};return{onBefore:function(){return i(),r!==!1&&(u.current=setTimeout(function(){e.setState({loading:!0})},t)),{loading:!1}},onFinally:function(){i()},onCancel:function(){i()}}};const se=oe;var D=!!(typeof window<"u"&&window.document&&window.document.createElement);function H(){return D?document.visibilityState!=="hidden":!0}var C=[];function ce(e){return C.push(e),function(){var t=C.indexOf(e);C.splice(t,1)}}if(D){var fe=function(){if(H())for(var e=0;e<C.length;e++){var n=C[e];n()}};window.addEventListener("visibilitychange",fe,!1)}var le=function(e,n){var t=n.pollingInterval,r=n.pollingWhenHidden,u=r===void 0?!0:r,i=n.pollingErrorRetryCount,o=i===void 0?-1:i,s=React.useRef(),c=React.useRef(),a=React.useRef(0),d=function(){var f;s.current&&clearTimeout(s.current),(f=c.current)===null||f===void 0||f.call(c)};return B(function(){t||d()},[t]),t?{onBefore:function(){d()},onError:function(){a.current+=1},onSuccess:function(){a.current=0},onFinally:function(){o===-1||o!==-1&&a.current<=o?s.current=setTimeout(function(){!u&&!H()?c.current=ce(function(){e.refresh()}):e.refresh()},t):a.current=0},onCancel:function(){d()}}:{}};const ve=le;function de(e,n){var t=!1;return function(){for(var r=[],u=0;u<arguments.length;u++)r[u]=arguments[u];t||(t=!0,e.apply(void 0,p([],g(r),!1)),setTimeout(function(){t=!1},n))}}function ge(){return D&&typeof navigator.onLine<"u"?navigator.onLine:!0}var T=[];function he(e){return T.push(e),function(){var t=T.indexOf(e);t>-1&&T.splice(t,1)}}if(D){var N=function(){if(!(!H()||!ge()))for(var e=0;e<T.length;e++){var n=T[e];n()}};window.addEventListener("visibilitychange",N,!1),window.addEventListener("focus",N,!1)}var me=function(e,n){var t=n.refreshOnWindowFocus,r=n.focusTimespan,u=r===void 0?5e3:r,i=React.useRef(),o=function(){var s;(s=i.current)===null||s===void 0||s.call(i)};return React.useEffect(function(){if(t){var s=de(e.refresh.bind(e),u);i.current=he(function(){s()})}return function(){o()}},[t,u]),M(function(){o()}),{}};const pe=me;var Re=function(e,n){var t=n.retryInterval,r=n.retryCount,u=React.useRef(),i=React.useRef(0),o=React.useRef(!1);return r?{onBefore:function(){o.current||(i.current=0),o.current=!1,u.current&&clearTimeout(u.current)},onSuccess:function(){i.current=0},onError:function(){if(i.current+=1,r===-1||i.current<=r){var s=t??Math.min(1e3*Math.pow(2,i.current),3e4);u.current=setTimeout(function(){o.current=!0,e.refresh()},s)}else i.current=0},onCancel:function(){i.current=0,u.current&&clearTimeout(u.current)}}:{}};const be=Re;var ye=function(e,n){var t=n.throttleWait,r=n.throttleLeading,u=n.throttleTrailing,i=React.useRef(),o={};return r!==void 0&&(o.leading=r),u!==void 0&&(o.trailing=u),React.useEffect(function(){if(t){var s=e.runAsync.bind(e);return i.current=U(function(c){c()},t,o),e.runAsync=function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];return new Promise(function(d,f){var h;(h=i.current)===null||h===void 0||h.call(i,function(){s.apply(void 0,p([],g(c),!1)).then(d).catch(f)})})},function(){var c;e.runAsync=s,(c=i.current)===null||c===void 0||c.cancel()}}},[t,r,u]),t?{onCancel:function(){var s;(s=i.current)===null||s===void 0||s.cancel()}}:{}};const Pe=ye;var we=function(e){React.useEffect(function(){e?.()},[])},Se=function(){var e=g(React.useState({}),2),n=e[1];return React.useCallback(function(){return n({})},[])},Ce=function(){function e(n,t,r,u){u===void 0&&(u={}),this.serviceRef=n,this.options=t,this.subscribe=r,this.initState=u,this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=R(R(R({},this.state),{loading:!t.manual}),u)}return e.prototype.setState=function(n){n===void 0&&(n={}),this.state=R(R({},this.state),n),this.subscribe()},e.prototype.runPluginHandler=function(n){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var u=this.pluginImpls.map(function(i){var o;return(o=i[n])===null||o===void 0?void 0:o.call.apply(o,p([i],g(t),!1))}).filter(Boolean);return Object.assign.apply(Object,p([{}],g(u),!1))},e.prototype.runAsync=function(){for(var n,t,r,u,i,o,s,c,a,d,f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];return K(this,void 0,void 0,function(){var l,v,m,E,L,_,W,A,b,y,x;return Q(this,function(S){switch(S.label){case 0:if(this.count+=1,l=this.count,v=this.runPluginHandler("onBefore",f),m=v.stopNow,E=m===void 0?!1:m,L=v.returnNow,_=L===void 0?!1:L,W=z(v,["stopNow","returnNow"]),E)return[2,new Promise(function(){})];if(this.setState(R({loading:!0,params:f},W)),_)return[2,Promise.resolve(W.data)];(t=(n=this.options).onBefore)===null||t===void 0||t.call(n,f),S.label=1;case 1:return S.trys.push([1,3,,4]),A=this.runPluginHandler("onRequest",this.serviceRef.current,f).servicePromise,A||(A=(x=this.serviceRef).current.apply(x,p([],g(f),!1))),[4,A];case 2:return b=S.sent(),l!==this.count?[2,new Promise(function(){})]:(this.setState({data:b,error:void 0,loading:!1}),(u=(r=this.options).onSuccess)===null||u===void 0||u.call(r,b,f),this.runPluginHandler("onSuccess",b,f),(o=(i=this.options).onFinally)===null||o===void 0||o.call(i,f,b,void 0),l===this.count&&this.runPluginHandler("onFinally",f,b,void 0),[2,b]);case 3:if(y=S.sent(),l!==this.count)return[2,new Promise(function(){})];throw this.setState({error:y,loading:!1}),(c=(s=this.options).onError)===null||c===void 0||c.call(s,y,f),this.runPluginHandler("onError",y,f),(d=(a=this.options).onFinally)===null||d===void 0||d.call(a,f,void 0,y),l===this.count&&this.runPluginHandler("onFinally",f,void 0,y),y;case 4:return[2]}})})},e.prototype.run=function(){for(var n=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this.runAsync.apply(this,p([],g(t),!1)).catch(function(u){n.options.onError})},e.prototype.cancel=function(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")},e.prototype.refresh=function(){this.run.apply(this,p([],g(this.state.params||[]),!1))},e.prototype.refreshAsync=function(){return this.runAsync.apply(this,p([],g(this.state.params||[]),!1))},e.prototype.mutate=function(n){var t=G(n)?n(this.state.data):n;this.runPluginHandler("onMutate",t),this.setState({data:t})},e}();const Te=Ce;function Ee(e,n,t){n===void 0&&(n={}),t===void 0&&(t=[]);var r=n.manual,u=r===void 0?!1:r,i=z(n,["manual"]),o=R({manual:u},i),s=j(e),c=Se(),a=J(function(){var d=t.map(function(f){var h;return(h=f?.onInit)===null||h===void 0?void 0:h.call(f,o)}).filter(Boolean);return new Te(s,o,c,Object.assign.apply(Object,p([{}],g(d),!1)))},[]);return a.options=o,a.pluginImpls=t.map(function(d){return d(a,o)}),we(function(){if(!u){var d=a.state.params||n.defaultParams||[];a.run.apply(a,p([],g(d),!1))}}),M(function(){a.cancel()}),{loading:a.state.loading,data:a.state.data,error:a.state.error,params:a.state.params||[],cancel:w(a.cancel.bind(a)),refresh:w(a.refresh.bind(a)),refreshAsync:w(a.refreshAsync.bind(a)),run:w(a.run.bind(a)),runAsync:w(a.runAsync.bind(a)),mutate:w(a.mutate.bind(a))}}function De(e,n,t){return Ee(e,n,p(p([],g(t||[]),!1),[ie,se,ve,pe,Pe,Z,ue,be],!1))}function Ae(e,n){e===void 0&&(e=!1);var t=g(React.useState(e),2),r=t[0],u=t[1],i=React.useMemo(function(){var o=n===void 0?!e:n,s=function(){return u(function(f){return f===e?o:e})},c=function(f){return u(f)},a=function(){return u(e)},d=function(){return u(o)};return{toggle:s,set:c,setLeft:a,setRight:d}},[]);return[r,i]}function Le(e){e===void 0&&(e=!1);var n=g(Ae(!!e),2),t=n[0],r=n[1],u=r.toggle,i=r.set,o=React.useMemo(function(){var s=function(){return i(!0)},c=function(){return i(!1)};return{toggle:u,set:function(a){return i(!!a)},setTrue:s,setFalse:c}},[]);return[t,o]}function We(e){var n=g(React.useState(e),2),t=n[0],r=n[1],u=React.useRef(t);u.current=t;var i=React.useCallback(function(){return u.current},[]);return[t,r,i]}var Fe=function(){var e=React.useRef(!1);return React.useEffect(function(){return e.current=!1,function(){e.current=!0}},[]),e};function $e(e){var n=Fe(),t=g(React.useState(e),2),r=t[0],u=t[1],i=React.useCallback(function(o){n.current||u(o)},[]);return[r,i]}var Be=function(e){var n=g(React.useState(e),2),t=n[0],r=n[1],u=React.useCallback(function(i){r(function(o){var s=G(i)?i(o):i;return s?R(R({},o),s):o})},[]);return[t,u]};function je(e,n){var t,r=j(e),u=(t=n?.wait)!==null&&t!==void 0?t:1e3,i=React.useMemo(function(){return U(function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return r.current.apply(r,p([],g(o),!1))},u,n)},[]);return M(function(){i.cancel()}),{run:i,cancel:i.cancel,flush:i.flush}}export{B as a,We as b,Be as c,je as d,$e as e,Le as f,De as u};
