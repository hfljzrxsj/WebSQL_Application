import{j as t}from"./react-ejZHSj7z.js";import{u as G,a as A,b as v,c as k}from"./ahooks-2LYmWdKG.js";import{S as J,P as p,C as Q,T as P,F as X,a as Z,b as V,I as ee,c as te,M as T,B as se,A as E,d as ne,e as re,f as W,g as D,h as ae,i as oe}from"./@mui-ExC6JS7J.js";import"./object-assign-4_VUvG2Z.js";import"./tslib-g6pQwBLH.js";import"./lodash-hv2pLSqc.js";import"./dayjs-5-cIlDoe.js";import"./@babel-pdUxmcoj.js";import"./clsx-2Jv0kmJG.js";import"./@emotion-JyQ-f8qM.js";import"./hoist-non-react-statics-o0ngdJFr.js";import"./stylis-UTZzoVRx.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function c(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=c(n);fetch(n.href,a)}})();const le="_Paper_12p6u_2",ie="_Input_12p6u_19",ce="_sqlInput_12p6u_38",ue="_last_12p6u_45",de="_fullWidth_12p6u_53",me="_Snackbar_12p6u_60",he="_Skeleton_12p6u_68",h={Paper:le,Input:ie,sqlInput:ce,last:ue,fullWidth:de,Snackbar:me,Skeleton:he},{log:w}=console,fe=l=>{const u=c=>requestIdleCallback?.(()=>setTimeout?.(()=>requestAnimationFrame?.(()=>queueMicrotask?.(()=>Promise?.resolve?.()?.then?.(()=>{const{port1:i,port2:n}=new MessageChannel;n.onmessage=()=>c?.(),i?.postMessage?.(null)}).catch(console?.error)))));return new Promise(c=>new Promise(i=>u?.(i))?.then?.(()=>u?.(()=>{l?.(),c?.()})).catch(console?.error)).catch(console?.error)},pe=window??global??globalThis??self??void 0,z="table",be="1.0",xe=z,ve=2*1024*1024,B=pe.openDatabase(z,be,xe,ve,l=>{w("sucess",l,"version",l.version)});fetch("assets/sql.sql").then(l=>l.text()).then(l=>{B.transaction(u=>{l.split(";").forEach(c=>{const i=c.trim();i&&u.executeSql(i)})},console.error,()=>{w("Yes, hjx!")})});const g=0,ge="未选择";function Se(){const{data:l,loading:u}=G(()=>fetch("assets/config.json").then(e=>e.json()),{loadingDelay:300,throttleWait:300}),c=l?.config??[],[i,n]=A(""),[a,d]=v({}),C=Object.entries(a).filter(([,e])=>e!==""),S=e=>c.reduce((r,s)=>(r[s.id]=s.type?!1:e,r),{}),[_,q]=v(S(!1)),H=Object.values(_),[$,M]=v(S(!1)),N=(e=i)=>{const r=e.trim().split(";");B.transaction(s=>{for(let o of r)o&&s.executeSql(o,[],function(j,y){const{rows:b}=y;w(y),K({rows:b})})},s=>{R({severity:"error",text:`执行失败, 原因：${s.message}`})},()=>{})};k(()=>ReactDOM.unstable_batchedUpdates(()=>{const e=`SELECT * FROM ${l?.tableName};`;n(e),q(S(!1)),M(S(!1)),fe(()=>N(e))}),[l?.tableName]);const[U,K]=v({insertId:0,rowsAffected:0,rows:{length:0,item:()=>{}}});k(()=>{n(`SELECT ${H.every(e=>!e)?"*":Object.entries(_).reduce((e,r)=>r[1]?[...e,r[0]]:e,[]).join(", ")} FROM ${l?.tableName}${C.length===0?"":" WHERE "+C.reduce((e,r)=>{const[s,o]=r;return o===""?e:Array.isArray(o)?[...e,`(${s}>=${o[0]}) and (${s}<=${o[1]})`]:[...e,`${s} ${$[s]?`like "%${o.toString()}%"`:`= "${o.toString()}"`} `]},[]).join(" and ")};`)},[a,$,_]);const m=U?.rows,O=React.useMemo(()=>m.length?Object.keys(m.item(0)??{}):[],[m]),[f,R]=v({severity:"info",text:"待操作"}),[Y,F]=A(!1);k(()=>{R({severity:"success",text:`执行成功, 查到 ${m?.length} 条记录`}),F(!0)},[m]);const I=(e,r)=>{r!=="clickaway"&&F(!1)};return u||c.length===0?t.jsx(J,{className:h.Skeleton??"",variant:"rounded",animation:"wave"}):t.jsxs(t.Fragment,{children:[t.jsxs(p,{elevation:24,className:h.Paper??"",children:[t.jsx(p,{elevation:24,className:h.Input??"",children:c.map((e,r)=>t.jsxs(p,{elevation:24,className:classNames({[h.last??""]:e.type==="between"})??"",children:[t.jsx(Q,{onChange:(s,o)=>{q({[e.id]:o})}}),(()=>{switch(e.type){case"enum":return t.jsxs(V,{fullWidth:!0,children:[t.jsx(ee,{children:e.name}),t.jsxs(te,{fullWidth:!0,value:a[e.id]?.toString(),label:e.name,onChange:s=>{d({[e.id]:s.target.value})},children:[t.jsx(T,{value:"",children:ge}),e.enum?.map(s=>t.jsx(T,{value:s,children:s}))]})]});case"between":{const s=a[e.id];return t.jsxs(t.Fragment,{children:[t.jsx("span",{children:e.name}),t.jsx(Z,{value:Array.isArray(s)?s:[0,100],onChange:(o,j,y)=>{if(!Array.isArray(j))return;const[b,L]=j;if(b!==void 0&&L!==void 0)if(L-b<g)if(y===0){const x=Math.min(b,100-g);d({[e.id]:[x,x+g]})}else{const x=Math.max(L,g);d({[e.id]:[x-g,x]})}else d({[e.id]:j})},valueLabelDisplay:"on",disableSwap:!0})]})}default:return t.jsxs(t.Fragment,{children:[t.jsx(P,{autoFocus:!0,"aria-autocomplete":"both",label:e.name,type:e.type==="number"?"number":"search",value:a[e.id],onChange:s=>{d({[e.id]:s.target.value})}}),t.jsx(X,{control:t.jsx(Q,{}),label:"模糊搜索",onChange:(s,o)=>M({[e.id]:o})})]})}})()]},r))}),t.jsxs(p,{elevation:24,className:h.sqlInput??"",children:[t.jsx(P,{multiline:!0,autoFocus:!0,fullWidth:!0,"aria-autocomplete":"both",label:"SQL",onChange:e=>n(e.target.value),value:i}),t.jsx(se,{size:"large",variant:"contained",onClick:e=>N(i),children:"Transaction"})]}),t.jsx(p,{elevation:24,className:h.fullWidth??"",children:t.jsx(E,{severity:f.severity,variant:"filled",children:f.text})}),t.jsx(p,{elevation:24,children:t.jsxs(ne,{stickyHeader:!0,children:[t.jsx(re,{children:t.jsx(W,{children:O.map((e,r)=>t.jsx(D,{align:"center",children:e},r))})}),t.jsx(ae,{children:new Array(m.length).fill(" ").map((e,r)=>t.jsx(W,{hover:!0,children:O.map((s,o)=>t.jsx(D,{align:"center",children:m?.item(r)[s]},o))},r))})]})})]}),t.jsx(oe,{open:!!(Y&&f.text),autoHideDuration:3e3,onClose:I,message:f.text,className:h.Snackbar??"",children:t.jsx(E,{onClose:I,severity:f.severity,variant:"filled",children:f.text})})]})}ReactDOM.render(t.jsx(Se,{}),document.body);
