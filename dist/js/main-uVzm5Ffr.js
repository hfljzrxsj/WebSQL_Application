import{j as t}from"./react-ejZHSj7z.js";import{u as Y,a as A,b as v,c as L}from"./ahooks-2LYmWdKG.js";import{S as G,P as p,C as I,T as P,F as J,a as X,b as Z,I as V,c as ee,M as Q,B as te,A as T,d as se,e as re,f as E,g as W,h as ne,i as ae}from"./@mui-ExC6JS7J.js";import"./object-assign-4_VUvG2Z.js";import"./tslib-g6pQwBLH.js";import"./lodash-hv2pLSqc.js";import"./dayjs-5-cIlDoe.js";import"./@babel-pdUxmcoj.js";import"./clsx-2Jv0kmJG.js";import"./@emotion-JyQ-f8qM.js";import"./hoist-non-react-statics-o0ngdJFr.js";import"./stylis-UTZzoVRx.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const oe="_Paper_12p6u_2",le="_Input_12p6u_19",ie="_sqlInput_12p6u_38",ce="_last_12p6u_45",ue="_fullWidth_12p6u_53",de="_Snackbar_12p6u_60",me="_Skeleton_12p6u_68",h={Paper:oe,Input:le,sqlInput:ie,last:ce,fullWidth:ue,Snackbar:de,Skeleton:me},{log:k}=console,he=l=>{const u=i=>requestIdleCallback?.(()=>setTimeout?.(()=>requestAnimationFrame?.(()=>queueMicrotask?.(()=>Promise?.resolve?.()?.then?.(()=>{const{port1:c,port2:n}=new MessageChannel;n.onmessage=()=>i?.(),c?.postMessage?.(null)}).catch(console?.error)))));return new Promise(i=>new Promise(c=>u?.(c))?.then?.(()=>u?.(()=>{l?.(),i?.()})).catch(console?.error)).catch(console?.error)},fe=window??global??globalThis??self??void 0,D="table",pe="1.0",be=D,xe=2*1024*1024,z=fe.openDatabase(D,pe,be,xe,l=>{k("sucess",l,"version",l.version)});fetch("assets/sql.sql").then(l=>l.text()).then(l=>{z.transaction(u=>{l.split(";").forEach(i=>{const c=i.trim();c&&u.executeSql(c)})},console.error,()=>{k("Yes, hjx!")})});const g=0,ve="未选择";function ge(){const{data:l,loading:u}=Y(()=>fetch("assets/config.json").then(e=>e.json()),{loadingDelay:300,throttleWait:300}),i=l?.config??[],[c,n]=A(""),[a,d]=v({}),w=Object.entries(a).filter(([,e])=>e!==""),[y,C]=v(i.reduce((e,r)=>(e[r.id]=!1,e),{})),B=Object.values(y),[q,$]=v(i.reduce((e,r)=>(e[r.id]=!0,e),{})),M=(e=c)=>{const r=e.trim().split(";");z.transaction(s=>{for(let o of r)o&&s.executeSql(o,[],function(j,S){const{rows:b}=S;k(S),U({rows:b})})},s=>{O({severity:"error",text:`执行失败, 原因：${s.message}`})},()=>{})};L(()=>ReactDOM.unstable_batchedUpdates(()=>{const e=`SELECT * FROM ${l?.tableName};`;n(e),C(i.reduce((r,s)=>(r[s.id]=!1,r),{})),$(i.reduce((r,s)=>(r[s.id]=!0,r),{})),he(()=>M(e))}),[l?.tableName]);const[H,U]=v({insertId:0,rowsAffected:0,rows:{length:0,item:()=>{}}});L(()=>{n(`SELECT ${B.every(e=>!e)?"*":Object.entries(y).reduce((e,r)=>r[1]?[...e,r[0]]:e,[]).join(", ")} FROM ${l?.tableName}${w.length===0?"":" WHERE "+w.reduce((e,r)=>{const[s,o]=r;return o===""?e:Array.isArray(o)?[...e,`(${s}>=${o[0]}) and (${s}<=${o[1]})`]:[...e,`${s} ${q[s]?`like "%${o.toString()}%"`:`= "${o.toString()}"`} `]},[]).join(" and ")};`)},[a,q,y]);const m=H?.rows,N=React.useMemo(()=>m.length?Object.keys(m.item(0)??{}):[],[m]),[f,O]=v({severity:"info",text:"待操作"}),[K,R]=A(!1);L(()=>{O({severity:"success",text:`执行成功, 查到 ${m?.length} 条记录`}),R(!0)},[m]);const F=(e,r)=>{r!=="clickaway"&&R(!1)};return u||i.length===0?t.jsx(G,{className:h.Skeleton??"",variant:"rounded",animation:"wave"}):t.jsxs(t.Fragment,{children:[t.jsxs(p,{elevation:24,className:h.Paper??"",children:[t.jsx(p,{elevation:24,className:h.Input??"",children:i.map((e,r)=>t.jsxs(p,{elevation:24,className:classNames({[h.last??""]:e.type==="between"})??"",children:[t.jsx(I,{onChange:(s,o)=>{C({[e.id]:o})}}),(()=>{switch(e.type){case"enum":return t.jsxs(Z,{fullWidth:!0,children:[t.jsx(V,{children:e.name}),t.jsxs(ee,{fullWidth:!0,value:a[e.id]?.toString(),label:e.name,onChange:s=>{d({[e.id]:s.target.value})},children:[t.jsx(Q,{value:"",children:ve}),e.enum?.map(s=>t.jsx(Q,{value:s,children:s}))]})]});case"between":{const s=a[e.id];return t.jsxs(t.Fragment,{children:[t.jsx("span",{children:e.name}),t.jsx(X,{value:Array.isArray(s)?s:[0,100],onChange:(o,j,S)=>{if(!Array.isArray(j))return;const[b,_]=j;if(b!==void 0&&_!==void 0)if(_-b<g)if(S===0){const x=Math.min(b,100-g);d({[e.id]:[x,x+g]})}else{const x=Math.max(_,g);d({[e.id]:[x-g,x]})}else d({[e.id]:j})},valueLabelDisplay:"on",disableSwap:!0})]})}default:return t.jsxs(t.Fragment,{children:[t.jsx(P,{autoFocus:!0,"aria-autocomplete":"both",label:e.name,type:e.type==="number"?"number":"search",value:a[e.id],onChange:s=>{d({[e.id]:s.target.value})}}),t.jsx(J,{control:t.jsx(I,{defaultChecked:!0}),label:"模糊搜索",onChange:(s,o)=>$({[e.id]:o})})]})}})()]},r))}),t.jsxs(p,{elevation:24,className:h.sqlInput??"",children:[t.jsx(P,{multiline:!0,autoFocus:!0,fullWidth:!0,"aria-autocomplete":"both",label:"SQL",onChange:e=>n(e.target.value),value:c}),t.jsx(te,{size:"large",variant:"contained",onClick:e=>M(c),children:"Transaction"})]}),t.jsx(p,{elevation:24,className:h.fullWidth??"",children:t.jsx(T,{severity:f.severity,variant:"filled",children:f.text})}),t.jsx(p,{elevation:24,children:t.jsxs(se,{stickyHeader:!0,children:[t.jsx(re,{children:t.jsx(E,{children:N.map((e,r)=>t.jsx(W,{align:"center",children:e},r))})}),t.jsx(ne,{children:new Array(m.length).fill(" ").map((e,r)=>t.jsx(E,{hover:!0,children:N.map((s,o)=>t.jsx(W,{align:"center",children:m?.item(r)[s]},o))},r))})]})})]}),t.jsx(ae,{open:!!(K&&f.text),autoHideDuration:3e3,onClose:F,message:f.text,className:h.Snackbar??"",children:t.jsx(T,{onClose:F,severity:f.severity,variant:"filled",children:f.text})})]})}ReactDOM.render(t.jsx(ge,{}),document.body);
